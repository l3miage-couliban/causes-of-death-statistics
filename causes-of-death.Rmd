---
title: "Causes of death in the world"
author: "N'Djo-Soro Coulibaly, Ciré Keïta, Higo Aragao, Thi Tran"
date: "2024-03-05"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

## Context of the problem
  Il est question d'analyser des données concernant les causes de mortalité dans le monde. Pour mener à bien cette analyse, nous avons defini des questions sur lesquelles travailler:
  2) Les 10 principales causes de mort dans le monde ? 
    - Quelle décision prendre à partir du résultat
  3) Les 5 principales causes sur chaque continent ? 
  4) L'évolution des décès au fil des années (2007 - 2019) ?
  5) representation graphique map
  6) Ajout des données démographiques


## Comment les données ont-elles été recuillies ?
Les données proviennent de Our World In Data
Source: https://www.kaggle.com/datasets/ivanchvez/causes-of-death-our-world-in-data



D'autres questions pourront être ajoutées au fur et à mesure pour plus de précisions et d'interprétations


# Read Dataset

## Causes of death
Les données proviennent de Our World In Data
Source: https://www.kaggle.com/datasets/ivanchvez/causes-of-death-our-world-in-data
```{r}
library(tidyverse)
library(ggplot2)
theme_set(theme_minimal())

CausesData <- read_csv("20222703-causes-f-death-clean-output-v2.0.csv") %>%
  rename(iso_code=Code) %>%
  filter(Year %in% 1990:2019) %>%
  filter(!is.na(iso_code));
```
## Countries data

```{r}
CountriesData <- read_csv("owid-co2-data.csv") %>%
  select(year, iso_code, population, gdp) %>%
  filter(year %in% 1990:2019) %>%
  filter(!is.na(iso_code));
```

## Countries with their region
source:  https://github.com/lukes/ISO-3166-Countries-with-Regional-Codes/blob/master/all/all.csv.
These lists are the result of merging data from two sources, the Wikipedia ISO 3166-1 article for alpha and numeric country codes, and the UN Statistics site for countries' regional, and sub-regional codes. In addition to countries, it includes dependent territories.

```{r}
ContinentsData <- read_csv("continents2.csv") %>%
  select('alpha-3', region, name) %>%
  rename(iso_code='alpha-3') %>%
  filter(!is.na(region));
```

## join dataframes
```{r}
#data <- merge(CausesData, CountriesData, by="iso_code");
data <- left_join(CausesData, CountriesData, by=c("iso_code"="iso_code", "Year"="year")) %>%
  left_join(ContinentsData, by=c("iso_code"="iso_code")) %>%
  arrange(Year);
```


## 10 firsts causes of death

  
```{r}
ndc <- data %>%
  filter(!is.na(iso_code)) %>%
  filter(!is.na(`Death Numbers`)) %>%
  group_by(`Causes name`) %>%
  summarize(`Death Numbers`=sum(as.numeric(`Death Numbers`))) %>%
  arrange(desc(`Death Numbers`)) %>%
  top_n(10)
```


# COURBE D'EVOLUTION DU NOMBRE DE MORT SUR CHAQUE CONTINENT

```{r}
sumAfricaPopulation <- data %>% 
  filter(region=="Africa") %>%
  distinct(Entity,Year,population) %>%
  group_by(Year) %>%
  summarise(population=sum(population, na.rm = TRUE) / 100000000);

sumAfricaGdP <- data %>% filter(region=="Africa") %>%
  distinct(Entity,Year,gdp) %>%
  group_by(Year) %>%
  summarise(gdp=sum(gdp, na.rm = TRUE) / 10);

sumAfricaDeaths <- data %>%
  filter(region=="Africa") %>% 
  group_by(Year) %>%
  summarise(death_numbers=sum(`Death Numbers`, na.rm = TRUE) / 1000000);



africaData <- left_join(sumAfricaPopulation, sumAfricaGdP, by=c("Year"="Year")) %>%
  left_join(sumAfricaDeaths, by=c("Year"="Year"));

plotAfrica <- africaData %>%
  ggplot(aes(x=Year)) + 
  geom_line(aes(y = death_numbers), stat = "identity", width = 0.5, col='red') +
  geom_line(aes(y = population), stat = "identity", width = 0.5, col='blue')+
  scale_y_continuous(
    name = "Nombre de décès en millions",
    sec.axis = sec_axis(~., name="population en centaine de millions"),
  )+
  scale_x_continuous(breaks = seq(1990, 2019, by = 2))+
  labs(
    title = "Evolution de la population et du nombre de décès par année en Afrique"
  );
```

```{r}
sumAmericaPopulation <- data %>% 
  filter(region=="Americas") %>%
  distinct(Entity,Year,population) %>%
  group_by(Year) %>%
  summarise(population=sum(population, na.rm = TRUE) / 100000000);

sumAmericaGdP <- data %>% filter(region=="Americas") %>%
  distinct(Entity,Year,gdp) %>%
  group_by(Year) %>%
  summarise(gdp=sum(gdp, na.rm = TRUE) / 10);

sumAmericaDeaths <- data %>%
  filter(region=="Americas") %>% 
  group_by(Year) %>%
  summarise(death_numbers=sum(`Death Numbers`, na.rm = TRUE) / 1000000);



americaData <- left_join(sumAmericaPopulation, sumAmericaGdP, by=c("Year"="Year")) %>%
  left_join(sumAmericaDeaths, by=c("Year"="Year"));

plotAmerica <- ggplot(americaData, aes(x = Year)) + 
  geom_line(aes(y = death_numbers, color = "Deaths"), size = 0.5) +
  geom_line(aes(y = population, color = "Population"), size = 0.5) +
  scale_color_manual(values = c("Deaths" = "red", "Population" = "blue")) +
  labs(color = "Title", title = "Evolution de la population et du nombre de décès par année en Amérique")+
  scale_x_continuous(breaks = seq(1990, 2018, by = 2))

```

```{r}
sumAsiaPopulation <- data %>% 
  filter(region=="Asia") %>%
  distinct(Entity,Year,population) %>%
  group_by(Year) %>%
  summarise(population=sum(population, na.rm = TRUE) / 100000000);

sumAsiaGdP <- data %>% filter(region=="Asia") %>%
  distinct(Entity,Year,gdp) %>%
  group_by(Year) %>%
  summarise(gdp=sum(gdp, na.rm = TRUE) / 10);

sumAsiaDeaths <- data %>%
  filter(region=="Asia") %>% 
  group_by(Year) %>%
  summarise(death_numbers=sum(`Death Numbers`, na.rm = TRUE) / 1000000);



asiaData <- left_join(sumAsiaPopulation, sumAsiaGdP, by=c("Year"="Year")) %>%
  left_join(sumAsiaDeaths, by=c("Year"="Year"));


plotAsia <- ggplot(asiaData, aes(x = Year)) + 
  geom_line(aes(y = death_numbers, color = "Deaths"), size = 0.5) +
  geom_line(aes(y = population, color = "Population"), size = 0.5) +
  scale_color_manual(values = c("Deaths" = "red", "Population" = "blue")) +
  labs(color = "Title", title = "Evolution de la population et du nombre de décès par année en Asie")+
  scale_x_continuous(breaks = seq(1990, 2018, by = 2))
```


```{r}
sumOceaniaPopulation <- data %>% 
  filter(region=="Oceania") %>%
  distinct(Entity,Year,population) %>%
  group_by(Year) %>%
  summarise(population=sum(population, na.rm = TRUE) / 100000000);

sumOceaniaGdP <- data %>% filter(region=="Oceania") %>%
  distinct(Entity,Year,gdp) %>%
  group_by(Year) %>%
  summarise(gdp=sum(gdp, na.rm = TRUE) / 10);

sumOceaniaDeaths <- data %>%
  filter(region=="Oceania") %>% 
  group_by(Year) %>%
  summarise(death_numbers=sum(`Death Numbers`, na.rm = TRUE) / 1000000);



oceaniaData <- left_join(sumOceaniaPopulation, sumOceaniaGdP, by=c("Year"="Year")) %>%
  left_join(sumOceaniaDeaths, by=c("Year"="Year"));

plotOceania <- ggplot(oceaniaData, aes(x = Year)) + 
  geom_line(aes(y = death_numbers, color = "Deaths"), size = 0.5) +
  geom_line(aes(y = population, color = "Population"), size = 0.5) +
  scale_color_manual(values = c("Deaths" = "red", "Population" = "blue")) +
  labs(color = "Title", title = "Evolution de la population et du nombre de décès par année en Océanie")+
  scale_x_continuous(breaks = seq(1990, 2018, by = 2))
```

# IN EUROPE
```{r}
library(ggplot2)
library(tidyverse)

sumEuropePopulation <- data %>% 
  filter(region=="Europe") %>%
  distinct(Entity,Year,population) %>%
  group_by(Year) %>%
  summarise(population=sum(population, na.rm = TRUE) / 100000000);

sumEuropeGdP <- data %>% filter(region=="Europe") %>%
  distinct(Entity,Year,gdp) %>%
  group_by(Year) %>%
  summarise(gdp=sum(gdp, na.rm = TRUE) / 10);

sumEuropeDeaths <- data %>%
  filter(region=="Europe") %>% 
  group_by(Year) %>%
  summarise(death_numbers=sum(`Death Numbers`, na.rm = TRUE) / 1000000);



europeData <- left_join(sumEuropePopulation, sumEuropeGdP, by=c("Year"="Year")) %>%
  left_join(sumEuropeDeaths, by=c("Year"="Year"));

plotEurope <- ggplot(europeData, aes(x = Year)) + 
  geom_line(aes(y = death_numbers, color = "Deaths"), size = 0.5) +
  geom_line(aes(y = population, color = "Population"), size = 0.5) +
  scale_color_manual(values = c("Deaths" = "red", "Population" = "blue")) +
  labs(color = "Title", title = "Evolution de la population et du nombre de décès par année en Europe")+
  scale_x_continuous(breaks = seq(1990, 2018, by = 2))
```


```{r}
scale_europe = scale(europeData[,-1], center = T,scale = T)
year= as.data.frame(seq(1990,2019,by=1))
scale_euro=cbind(year,scale_europe)
```


```{r}
scale_euro=as.data.frame(scale_euro)
scale_euro %>% 
  rename(Year=`seq(1990, 2019, by = 1)`) %>% 
  ggplot(aes(x=Year), mapping) + 
  geom_line(aes(y = death_numbers), col='red', stat = "identity", width = 1) +
  geom_line(aes(y = population), col='blue',stat = "identity", width = 1)+
  geom_line(aes(y = gdp), col='green',stat = "identity", width = 1) 
```


```{r}
library(ggplot2)
library(patchwork)

# adjuste les themas individuelle
plotAfrica <- plotAfrica + theme_minimal(base_size = 5)
plotAmerica <- plotAmerica + theme_minimal(base_size = 5)
plotAsia <- plotAsia + theme_minimal(base_size = 5)
plotOceania <- plotOceania + theme_minimal(base_size = 5)
plotEurope <- plotEurope + theme_minimal(base_size = 5)

grid_plots = plotAfrica + plotAmerica + plotAsia + plotOceania + plotEurope + 
  plot_layout(ncol = 2)


grid_plots


```

